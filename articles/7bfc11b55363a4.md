---
title: "SizedBox ã§ç†è§£ã™ã‚‹ Flutter ã®ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆè¨ˆç®—"
emoji: "ğŸ¥¡"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: [Flutter, RenderObject]
published: true
---

ã„ããªã‚Šã§ã™ãŒå•é¡Œã§ã™ã€‚
ä»¥ä¸‹ã® Flutter ã®ã‚³ãƒ¼ãƒ‰ã‚’å®Ÿè¡Œã—ãŸå ´åˆã€ã©ã®ã‚ˆã†ãª UI ã«ãªã‚‹ã§ã—ã‚‡ã†ã‹ã€‚

```dart:main.dart
void main() => runApp(
      const MaterialApp(
        home: Scaffold(
          body: SizedBox(
            // å¹…300é«˜ã•500ã®ç®±ã®ä¸­ã«
            width: 300,
            height: 500,
            child: SizedBox(
              // å¹…100é«˜ã•200ã®
              width: 100,
              height: 200,
              // é’ã„ç®±ã‚’ç½®ã
              child: ColoredBox(color: Colors.blue),
            ),
          ),
        ),
      ),
    );
```

ç­”ãˆã¯ä»¥ä¸‹ã§ã™ã€‚

![ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã®å®Ÿè¡Œçµæœ](https://user-images.githubusercontent.com/20849526/210027698-8722a736-107c-4c25-b62b-a62970fed379.png)

ç«¯æœ«ã®ç”»é¢ã‚µã‚¤ã‚ºãŒ `390x844` ãªã®ã§ã€æŒ‡å®šé€šã‚Š `100x200` ã®é’ã„ç®±ã‚’ç½®ã„ãŸã‚‰ç”»é¢ã®åŠåˆ†ã‚ˆã‚Šã‚‚å°ã•ãè¡¨ç¤ºã•ã‚Œãã†ã§ã™ãŒã€ãã†ã¯ãªã£ã¦ã„ã¾ã›ã‚“ã€‚`100x200` ã® `SizedBox` ã®è¦ªãŒæŒ‡å®šã—ã¦ã„ã‚‹ `300x500` ãŒé©ç”¨ã•ã‚Œã¦ã„ã¾ã™ã­ã€‚

ã“ã®è¨˜äº‹ã§ã¯ã€ãªãœã“ã®ã‚ˆã†ãªæŒ™å‹•ã«ãªã‚‹ã®ã‹ã‚’å®Ÿéš›ã«ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚„ã‚³ãƒ¼ãƒ‰ã‚’èª­ã¿ãªãŒã‚‰è€ƒãˆã‚‹ã“ã¨ã§ã€Flutter ã®ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆè¨ˆç®—ã®ä»•çµ„ã¿ã«ã¤ã„ã¦ç†è§£ã‚’æ·±ã‚ã¦ã„ãã¾ã™ã€‚

ãªãŠã€ã“ã®è¨˜äº‹ã¯ [Flutter Advent Calendar 2022](https://qiita.com/advent-calendar/2022/flutter) ã®2æ—¥ç›®ã§ã™ã€‚å®Ÿã«ã²ã¨æœˆé…ã‚Œã§ã®æŠ•ç¨¿ã«ãªã£ã¦ã—ã¾ã£ã¦ã™ã¿ã¾ã›ã‚“ã€ã€

# ã‚ã‚ã›ã¦èª­ã¿ãŸã„

ã“ã®è¨˜äº‹ã‚’èª­ã‚€ä¸Šã§ã€2022 å¹´ã® Flutter é–¢é€£ã®ã‚¢ãƒ‰ãƒ™ãƒ³ãƒˆã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã«ã„ãã¤ã‹åŒã˜ãƒˆãƒ”ãƒƒã‚¯ã®è¨˜äº‹ãŒæŠ•ç¨¿ã•ã‚Œã¦ã„ã¾ã™ã®ã§ã€å…ˆã«ç´¹ä»‹ã—ã¦ãŠãã¾ã™ã€‚

ã©ã‚Œã‚‚ RenderObject ã«ã‚ˆã‚‹ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆè¨ˆç®—ã‚„æç”»ã«ã¤ã„ã¦ã‚‚ã£ã¨ç†è§£ã‚’æ·±ã‚ã‚‰ã‚Œã‚‹è¨˜äº‹ã§ã™ã®ã§ã€ãœã²èª­ã‚“ã§ã¿ã¦ãã ã•ã„ã€‚

https://zenn.dev/mjhd/articles/81577dd49000eb
https://zenn.dev/kurogoma4d/articles/e0155b700ac2da
https://zenn.dev/heyhey1028/articles/532d0a9464c562

# æœ¬é¡Œ

ã§ã¯ã€å†’é ­ã®ã‚³ãƒ¼ãƒ‰ã§ãªãœé’ã„ç®±ãŒ `300x500` ã§æç”»ã•ã‚Œã¦ã—ã¾ã£ãŸã®ã‹ã«ã¤ã„ã¦è€ƒãˆã¦ã„ãã¾ã—ã‚‡ã†ã€‚

## Constraints ã¨ Size

Flutter ã®ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆè¨ˆç®—ã®åŸºç¤ã«ã¯ [Constraints go down. Sizes go up. Parent sets position.](https://docs.flutter.dev/development/ui/layout/constraints) ã®è€ƒãˆæ–¹ãŒã‚ã‚Šã¾ã™ã€‚

è¦ªã® Widgetï¼ˆãŒç”Ÿæˆã—ãŸ RenderObject ï¼‰ã¯å­ã® Widgetï¼ˆãŒç”Ÿæˆã—ãŸ RenderObjectï¼‰ã«å¯¾ã—ã¦ `Constraints`ï¼ˆåˆ¶ç´„ï¼‰ã‚’æ¸¡ã—ã€å­ã¯ãã®åˆ¶ç´„ã«åŸºã¥ã„ã¦ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆè¨ˆç®—ã—ãŸçµæœå¾—ã‚‰ã‚ŒãŸã€Œè‡ªèº«ã®ã‚µã‚¤ã‚ºã€ã‚’è¦ªã«è¿”å´ã—ã¾ã™ã€‚æœ€å¾Œã«è¦ªã¯ãã®ã‚µã‚¤ã‚ºã‚’è¦‹ãªãŒã‚‰é…ç½®ã™ã‚‹å ´æ‰€ã‚’æ±ºã‚ã‚‹ã€ã¨ã„ã†æµã‚Œã§ã™ã€‚

é‡è¦ãªç‚¹ã¯ã„ãã¤ã‹ã‚ã‚Šã¾ã™ãŒã€ç‰¹ã«æˆ‘ã€…ã‚¢ãƒ—ãƒªé–‹ç™ºè€…ãŒ UI ã‚’ä½œã‚‹ä¸Šã§æ„è­˜ã—ãŸã„ã®ãŒ

- __Widget ã®ã‚µã‚¤ã‚ºã¯è¦ªã‹ã‚‰ä¸ãˆã‚‰ã‚ŒãŸåˆ¶ç´„ã«ã‚ˆã£ã¦æ±ºå®šã™ã‚‹__
- __è¦ªã‹ã‚‰ä¸ãˆã‚‰ã‚ŒãŸåˆ¶ç´„ã‚’ã©ã†ä½¿ã†ã‹ã¯å€‹ã€…ã® Widgetï¼ˆãŒç”Ÿæˆã—ãŸ RenderObjectï¼‰ã®å®Ÿè£…æ¬¡ç¬¬ã§ã‚ã‚‹__

ã®2ç‚¹ã§ã™ã€‚

ä»Šå›ã¯ã€`SizedBox` ã¨ã€`SizedBox` ãŒç”Ÿæˆã™ã‚‹ RenderObject ã§ã‚ã‚‹ `RenderConstrainedBox` ã‚’ä¾‹ã«ã¨ã£ã¦ã€å®Ÿéš›ã«ã‚³ãƒ¼ãƒ‰ã‚’èª­ã¿ãªãŒã‚‰ã“ã®2ç‚¹ã‚’ç†è§£ã—ã¦ã„ããŸã„ã¨æ€ã„ã¾ã™ã€‚

## æœ€å¤§/æœ€å° ã® å¹…/é«˜ã• ã‚’æŒã¤ `BoxConstraints`

`Constraints` ã¯ãã®åã®é€šã‚Šã®ã‚¯ãƒ©ã‚¹ãŒãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã® `object.dart` ã«å®šç¾©ã•ã‚Œã¦ã„ã¾ã™ã€‚

ãŸã ã—ã€ã“ã‚Œã¯ `abstract` ãªã‚¯ãƒ©ã‚¹ã§ã€`RenderConstrainedBox` ãŒå®Ÿéš›ã«æ‰±ã†ã®ã¯ `Constraints` ã‚’ç¶™æ‰¿ã—ãŸ `BoxConstraints` ã¨ã„ã†ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã§ã™ã€‚

`BoxConstraints` ã¯ã€æ ã®ã€Œæœ€å°ã‚µã‚¤ã‚ºã€ã¨ã€Œæœ€å¤§ã‚µã‚¤ã‚ºã€ã‚’ä¿æŒã™ã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã§ã™ã€‚å®Ÿè£…ã‚’ä¸€éƒ¨æŠœç²‹ã™ã‚‹ã¨ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ã€‚

```dart:box.dart
class BoxConstraints extends Constraints {

  /// The minimum width that satisfies the constraints.
  final double minWidth;

  /// The maximum width that satisfies the constraints.
  ///
  /// Might be [double.infinity].
  final double maxWidth;

  /// The minimum height that satisfies the constraints.
  final double minHeight;

  /// The maximum height that satisfies the constraints.
  ///
  /// Might be [double.infinity].
  final double maxHeight;
}
```

æ³¨ç›®ã—ãŸã„ã®ãŒã€__ã“ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒä¿æŒã™ã‚‹ã®ã¯ã‚ãã¾ã§ã€Œã“ã“ã‹ã‚‰ã“ã“ã¾ã§ã®å¤§ãã•ã§ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚’ä½œã£ã¦ãã ã•ã„ã­ã€ã¨ã„ã†æƒ…å ±ã§ã‚ã‚‹__ ã¨ã„ã†ã“ã¨ã§ã™ã€‚æœ€çµ‚çš„ã«ç”»é¢ã«è¡¨ç¤ºã•ã‚Œã‚‹ã‚µã‚¤ã‚ºãã®ã‚‚ã®ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚

Widget ãŒæœ€çµ‚çš„ã«ã©ã®ã‚µã‚¤ã‚ºã§ç”»é¢ã«æç”»ã•ã‚Œã‚‹ã‹ã¯ã€ã“ã® `BoxConstraints` ã‚’å…ƒã« `RenderConstrainedBox` ãŒãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆè¨ˆç®—ã‚’ã—ãŸçµæœã«ã‚ˆã£ã¦æ±ºå®šã—ã¾ã™ã€‚

## ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚’è¨ˆç®—ã™ã‚‹ `performLayout()` ãƒ¡ã‚½ãƒƒãƒ‰

`RenderObject` ã¯ã€`performLayout()` ã¨ã„ã†ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ã‚ªãƒ¼ãƒãƒ¼ãƒ©ã‚¤ãƒ‰ã™ã‚‹ã“ã¨ã§å„å…·è±¡ã‚¯ãƒ©ã‚¹ã”ã¨ã®ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆè¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯ã‚’å®Ÿè£…ã—ã¾ã™ã€‚ã¤ã¾ã‚Šã€å†’é ­ã® `100x200` ã‚’æŒ‡å®šã—ãŸ `SizedBox` ãŒãªãœãã®é€šã‚Šã®ã‚µã‚¤ã‚ºã§è¡¨ç¤ºã•ã‚Œãªã‹ã£ãŸã®ã‹ã«ã¤ã„ã¦ã¯ã“ã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’è¿½ã†ã“ã¨ã§ç†è§£ã§ãã¾ã™ã€‚

`RenderConstrainedBox` ã® `performLayout()` ãƒ¡ã‚½ãƒƒãƒ‰ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«å®Ÿè£…ã•ã‚Œã¦ã„ã¾ã™ã€‚

```dart:proxy_box.dart
  @override
  void performLayout() {
    final BoxConstraints constraints = this.constraints;
    if (child != null) {
      child!.layout(_additionalConstraints.enforce(constraints), parentUsesSize: true);
      size = child!.size;
    } else {
      size = _additionalConstraints.enforce(constraints).constrain(Size.zero);
    }
  }
```

ä»Šå›ã¯ `child` ãŒ `null` ã§ã¯ãªã„å ´åˆãªã®ã§ã€æœ€åˆã®æ¡ä»¶åˆ†å²ã®ä¸­ã«æ³¨ç›®ã—ã¦ã„ãã¾ã—ã‚‡ã†ã€‚

ãªãŠä»Šå›ã®ã‚³ãƒ¼ãƒ‰ã§ã¯ã€`child` ã¯ `SizedBox` ã® `child` ã«æ¸¡ã—ãŸ `ColoredBox(color: Colors.blue)` ï¼ˆãŒç”Ÿæˆã—ãŸ RenderObjectï¼‰ã®ã“ã¨ã«ãªã‚Šã¾ã™ã€‚

æœ€åˆã®æ¡ä»¶åˆ†å²ã®ä¸­ã®ã‚³ãƒ¼ãƒ‰ã ã‘æŠœç²‹ã™ã‚‹ã¨ã€ä»¥ä¸‹ã®2è¡Œã«ãªã‚Šã¾ã™ã€‚

```dart
child!.layout(_additionalConstraints.enforce(constraints), parentUsesSize: true);
size = child!.size;
```

åŸºæœ¬çš„ã«ã¯ã€Œå­ã®ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆè¨ˆç®—ã®çµæœå¾—ã‚‰ã‚ŒãŸã‚µã‚¤ã‚ºã‚’è‡ªèº«ã®ã‚µã‚¤ã‚ºã¨ã™ã‚‹ã€ã¨ã„ã†å‡¦ç†ãŒæ›¸ã‹ã‚Œã¦ã„ã‚‹ã®ã¿ã§ã¨ã¦ã‚‚ã‚·ãƒ³ãƒ—ãƒ«ã§ã¯ã‚ã‚Šã¾ã™ãŒã€æ³¨ç›®ã—ãŸã„ã®ã¯ `child.layout()` ã®ç¬¬ï¼‘å¼•æ•°ã«æ¸¡ã—ã¦ã„ã‚‹ `BoxConstraint` ã®å†…å®¹ã§ã™ã€‚

`_additionalConstraints.enforce(constraints)` ã¨æ›¸ã‹ã‚Œã¦ã„ã¾ã™ã®ã§ã€`_additionalConstraints` ã¨ `constraints`ã€ãã—ã¦ `enforce()` ãŒä½•ãªã®ã‹ã‚’ãã‚Œãã‚Œç¢ºèªã—ã¦ã„ãã¾ã—ã‚‡ã†ã€‚

### _additinalConstraints

`_additionalConstraints` ã¯ã€ã‚³ãƒ¼ãƒ‰ã‚’è¿½ã£ã¦ã„ãã¨ `SizedBox` ã® `createRenderObject()` ãƒ¡ã‚½ãƒƒãƒ‰ã§ `RenderConstrainedBox` ã‚’ä½œã‚‹éš›ã«ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã«æ¸¡ã—ã¦ã„ã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã§ã™ã€‚

```dart:basic.dart
  @override
  RenderConstrainedBox createRenderObject(BuildContext context) {
    return RenderConstrainedBox(
      additionalConstraints: _additionalConstraints,
    );
  }

  BoxConstraints get _additionalConstraints {
    return BoxConstraints.tightFor(width: width, height: height);
  }
```

`width` `height` ã¯ã¾ã•ã« `SizedBox` ã‚’é…ç½®ã™ã‚‹ã¨ãã«ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã§æ¸¡ã—ãŸå€¤ã§ã™ã­ã€‚ä»Šå›ã¯ `width: 100` `height: 200` ã‚’æŒ‡å®šã—ã¦ã„ã¾ã™ã€‚

`BoxConstraints.tightFor()` ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã‚’å‘¼ã³å‡ºã™ã“ã¨ã§ã€å—ã‘å–ã£ãŸ `width` ã¨ `height` ã‹ã‚‰ `BoxConstraints` ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ç”Ÿæˆã—ã¦ã„ã‚‹ã¿ãŸã„ã§ã™ã€‚`.tightFor()` ã®å®Ÿè£…ã‚‚ç¢ºèªã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

```dart:box.dart
  const BoxConstraints.tightFor({
    double? width,
    double? height,
  }) : minWidth = width ?? 0.0,
       maxWidth = width ?? double.infinity,
       minHeight = height ?? 0.0,
       maxHeight = height ?? double.infinity;
```

ä»Šå›ã®ã‚ˆã†ã« `width` `height` ã®ã©ã¡ã‚‰ã‚‚æŒ‡å®šã—ãŸå ´åˆã¯ã€max / min ã¨ã‚‚ã«ä¸ãˆã‚‰ã‚ŒãŸå€¤ã® `width` ã¨ `height` ã®å€¤ã¨ãªã‚‹ã‚ˆã†ã§ã™ã€‚ãªãŠã€`BoxConstraints` ã«ãŠã„ã¦ `tight` ã¨ã¯ã€Œæœ€å°å€¤ã¨æœ€å¤§å€¤ãŒåŒã˜å€¤ã€ã§ã‚ã‚‹çŠ¶æ…‹ã‚’æŒ‡ã—ã¦ã„ã¾ã™ã€‚åå¯¾ã¯ `loose` ã§ã™ã€‚

> When the minimum constraints and the maximum constraint in an axis are the
> same, that axis is _tightly_ constrained. See: [
> BoxConstraints.tightFor], [BoxConstraints.tightForFinite], [tighten],
> [hasTightWidth], [hasTightHeight], [isTight].
>
> An axis with a minimum constraint of 0.0 is _loose_ (regardless of the
> maximum constraint; if it is also 0.0, then the axis is simultaneously tight
> and loose!). See: [BoxConstraints.loose], [loosen].

[https://api.flutter.dev/flutter/rendering/BoxConstraints-class.html](https://api.flutter.dev/flutter/rendering/BoxConstraints-class.html)

ã¾ã¨ã‚ã‚‹ã¨ã€ __`_additinalConstraints` ã¯ã€Œæœ€å°å€¤ã€æœ€å¤§å€¤ã¨ã‚‚ã«ä¸ãˆã‚‰ã‚ŒãŸ `width` ã¨ `height` ã‚’ä¿æŒã™ã‚‹ `BoxConstraints` ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã€__ ã¨ã„ã†ã“ã¨ã«ãªã‚Šã¾ã™ã€‚[^1]

### constraints

`constraints` ã¯ `performLayout()` ã®æœ€åˆã®ã‚¹ãƒ†ãƒƒãƒ—ã«æ›¸ã‹ã‚Œã¦ã„ã‚‹é€šã‚Šã€`this.constraint` ã§ã™ã€‚å®šç¾©ã«ã‚¸ãƒ£ãƒ³ãƒ—ã™ã‚‹ã¨ä»¥ä¸‹ã®ã‚ˆã†ã«æ›¸ã‹ã‚Œã¦ãŠã‚Šã€

```dart
  /// The box constraints most recently received from the parent.
  @override
  BoxConstraints get constraints => super.constraints as BoxConstraints;
```

ã‚³ãƒ¡ãƒ³ãƒˆã‹ã‚‰ã€Œè¦ªã‹ã‚‰å—ã‘å–ã£ãŸ `BoxConstraints` ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã€ã§ã‚ã‚‹ã“ã¨ãŒèª­ã¿å–ã‚Œã¾ã™ã€‚

ä»Šå›ã®å ´åˆã€è¦ªã¯ `300x500` ã‚’æŒ‡å®šã—ãŸ `SizedBox` ã§ã™ã®ã§ã€ï¼ˆã„ã‚ã„ã‚èª¬æ˜ã¯çœãã¾ã™ãŒï¼‰ __ã€Œæœ€å°å€¤ãƒ»æœ€å¤§å€¤ã¨ã‚‚ã« `300x500` ãŒæŒ‡å®šã•ã‚ŒãŸ `BoxConstraints` ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã€__ ã¨ãªã‚Šã¾ã™ã€‚

### .enforce()

æœ€å¾Œã« `.enforce()` ãƒ¡ã‚½ãƒƒãƒ‰ã§ã™ã€‚ã“ã‚Œã¯ `_additionalConstraints` ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒæŒã¤ãƒ¡ã‚½ãƒƒãƒ‰ã§ã€å¼•æ•°ã«ã¯è¦ªã‹ã‚‰å—ã‘å–ã£ãŸ `constraints` ã‚’æ¸¡ã™å½¢ã«ãªã£ã¦ã„ã¾ã™ã€‚

å®Ÿè£…ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ã€‚

```dart:box.dart
  /// Returns new box constraints that respect the given constraints while being
  /// as close as possible to the original constraints.
  BoxConstraints enforce(BoxConstraints constraints) {
    return BoxConstraints(
      minWidth: clampDouble(minWidth, constraints.minWidth, constraints.maxWidth),
      maxWidth: clampDouble(maxWidth, constraints.minWidth, constraints.maxWidth),
      minHeight: clampDouble(minHeight, constraints.minHeight, constraints.maxHeight),
      maxHeight: clampDouble(maxHeight, constraints.minHeight, constraints.maxHeight),
    );
  }
```

ãªãŠã€`clampDouble` ã¯ `num.clamp` ã¨åŒæ§˜ã®å‡¦ç†ã‚’è¡Œã†ãƒ¡ã‚½ãƒƒãƒ‰ã§ã€ç¬¬1å¼•æ•°ã§å—ã‘å–ã£ãŸå€¤ãŒç¬¬2å¼•æ•°ã®æœ€å°å€¤ã¨ç¬¬3å¼•æ•°ã®æœ€å¤§å€¤ã®ç¯„å›²å†…ã§ã‚ã‚Œã°ãã®ã¾ã¾ã®å€¤ã‚’ã€ãã†ã§ãªã‘ã‚Œã°æŒ‡å®šã—ãŸæœ€å°å€¤ / æœ€å¤§å€¤ã«å¯„ã›ãŸå€¤ã‚’è¿”å´ã™ã‚‹ãƒ¡ã‚½ãƒƒãƒ‰ã§ã™ã€‚

```dart:math.dart
double clampDouble(double x, double min, double max) {
  assert(min <= max && !max.isNaN && !min.isNaN);
  if (x < min) {
    return min;
  }
  if (x > max) {
    return max;
  }
  if (x.isNaN) {
    return max;
  }
  return x;
}
```

ã¤ã¾ã‚Šã€ä»Šå›ã®å€¤ã‚’å½“ã¦ã¯ã‚ã‚‹ã¨ä»¥ä¸‹ã®ã‚ˆã†ãªçµæœã«ãªã‚Šã¾ã™ã€‚

```dart
return BoxConstraints(
  minWidth: clampDouble(100, 300, 300), // -> 300
  maxWidth: clampDouble(100, 300, 300), // -> 300
  minHeight: clampDouble(200, 500, 500), // -> 500
  maxHeight: clampDouble(200, 500, 500), // -> 500
);
```

ã¨ã„ã†ã“ã¨ã§ã€æœ€å°å€¤ã€æœ€å¤§å€¤ã¨ã‚‚è¦ªã® `SizedBox` ãŒæŒ‡å®šã—ãŸ `300x500` ã«ä¸Šæ›¸ãã•ã‚Œã¦ã„ã‚‹(!)ã“ã¨ãŒã‚ã‹ã‚Šã¾ã—ãŸã€‚

`performLayout()` ã«æˆ»ã‚‹ã¨ã€ã“ã“ã§ç”Ÿæˆã•ã‚ŒãŸ `BoxConstraints` ãŒ `ColoredBox` ã«æ¸¡ã•ã‚Œã¦ãã®ã‚µã‚¤ã‚ºã®ç®±ãŒé’è‰²ã§æç”»ã•ã‚Œã‚‹ã“ã¨ã«ãªã‚Šã¾ã™ã€‚ä»Šå›ã® `BoxConstraints` ã¯ã€Œæœ€å°ã§ `300x500`ã€æœ€å¤§ã§ `300x500`ã€ã¤ã¾ã‚Šã©ã‚“ãªå ´åˆã§ã‚‚ `300x500` ã§ã‚ˆã‚ã—ãï¼ã€ã¨ã„ã†å†…å®¹ã«ãªã£ã¦ã„ã‚‹ãŸã‚ã€çµæœã¨ã—ã¦å†’é ­ã§è¦‹ãŸã‚ˆã†ãª `300x500` ã®é’ã„ç®±ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã€ã¨ã„ã†ã‚ã‘ã§ã™ã€‚

# ã„ã£ãŸã‚“ã¾ã¨ã‚

ã¨ã„ã†ã“ã¨ã§ã€ã“ã“ã¾ã§ `SizedBox` ã¨ãã® RenderObject ã§ã‚ã‚‹ `RenderConstrainedBox` ã®å®Ÿè£…ã‚’è¿½ã„ãªãŒã‚‰ã€ãªãœå†’é ­ã®ã‚³ãƒ¼ãƒ‰ãŒæŒ‡å®šã—ãŸé€šã‚Šã« `100x200` ã®é’ã„ç®±ã‚’æç”»ã—ã¦ãã‚Œãªã„ã®ã‹ã«ã¤ã„ã¦ç¢ºèªã—ã¾ã—ãŸã€‚

å®Ÿéš›ã«ã¯å†’é ­ã®ã‚ˆã†ãªã€Œã‚µã‚¤ã‚ºã‚’æŒ‡å®šã—ãŸ `SizedBox` ã® `child` ã«åˆ¥ã®ã‚µã‚¤ã‚ºã‚’æŒ‡å®šã—ãŸ `SizedBox` ã‚’æ¸¡ã™ã€ã‚ˆã†ãªãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚’çµ„ã‚€ã“ã¨ã¯ç„¡ã„ã¨æ€ã„ã¾ã™ãŒã€ã“ã®ã‚ˆã†ã«æ¸¡ã•ã‚ŒãŸ `BoxConstraints` ã®å†…å®¹ã¨ `performLayout()` ã®å®Ÿè£…æ¬¡ç¬¬ã§ç›´æ„Ÿã¨åã™ã‚‹ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆãŒå‡ºæ¥ä¸ŠãŒã£ã¦ã—ã¾ã†å ´åˆãŒã‚ã‚‹ã“ã¨ã¯ã‚¤ãƒ¡ãƒ¼ã‚¸ã§ããŸã®ã§ã¯ãªã„ã§ã—ã‚‡ã†ã‹ã€‚

Flutter ã«ãŠã„ã¦ __Widget ã®ã‚µã‚¤ã‚ºã¯è¦ªãŒæ¸¡ã—ãŸ `Constraints` ã¨ãã‚Œã‚’å—ã‘å–ã£ãŸ `RenderObject` ã®å®Ÿè£…ã«ã‚ˆã£ã¦æ±ºå®šã™ã‚‹__ ã¨ã„ã†ã“ã¨ã¯é ­ã«å…¥ã‚Œã¦ãŠãã¨ã€Widget ã‚’ä½¿ã£ã¦ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚’çµ„ã¿ä¸Šã’ã‚‹æ™‚ï¼ˆç‰¹ã«ã‚¤ãƒ¡ãƒ¼ã‚¸ã—ãŸãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆãŒãªã‹ãªã‹å®Ÿç¾ã—ã¦ãã‚Œãªã„æ™‚ï¼‰ã«å½¹ã«ç«‹ã¤ã®ã§ã¯ãªã„ã‹ã¨æ€ã„ã¾ã™ã€‚

__Widget è‡ªä½“ã«ã‚µã‚¤ã‚ºã‚’æŒ‡å®šã—ã‚ˆã†ã¨ã™ã‚‹ã®ã§ã¯ãªãã€è¦ªã‹ã‚‰ã‚µã‚¤ã‚ºã‚’æ¸¡ã—ã¦ã‚ã’ã‚‹__ ã¨ã„ã†ç™ºæƒ³ãŒã‚ã‚‹ã ã‘ã§ã ã„ã¶ `build()` ãƒ¡ã‚½ãƒƒãƒ‰ã®æ›¸ãæ–¹ãŒå¤‰ã‚ã‚‹ã®ã§ã¯ãªã„ã‹ã¨æ€ã„ã¾ã™ã€‚

ã¤ã„ã§ã«ã€ã„ã–ã¨ãªã£ãŸã‚‰ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã®ã‚³ãƒ¼ãƒ‰ã‚’è¿½ãˆã°ã€Œãªãœãã‚“ãªãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆãŒå‡ºæ¥ä¸ŠãŒã‚‹ã®ã‹ã€ã‚’ç¢ºèªã§ãã‚‹ã“ã¨ã‚‚ä½“é¨“ã§ãã¾ã—ãŸã­ã€‚

# ãŠã¾ã‘

ã“ã“ã¾ã§ã®è©±ãŒç†è§£ã§ãã‚‹ã¨ã€ã“ã‚Œã‚’å¿œç”¨ã—ã¦ã„ãã¤ã‹ã®å•é¡ŒãŒç†è§£ã€è§£æ±ºã§ãã¾ã™ã€‚

## å•é¡Œï¼‘ï¼š å†’é ­ã®ã‚³ãƒ¼ãƒ‰ã€100x200 ã®é’ã„ç®±ã‚’è¡¨ç¤ºã™ã‚‹ã«ã¯ã©ã†ã—ãŸã‚‰ã„ã„ã®ï¼Ÿ

æœ€å°å€¤ãŒ `0x0`, æœ€å¤§å€¤ãŒ `300x500` ã® `BoxConstraints` ã‚’ `child` ã«æ¸¡ã—ã¦ãã‚Œã‚‹ Widget ã‚’é–“ã«æŒŸã¿ã¾ã—ã‚‡ã†ã€‚ãŸã¨ãˆã° `Align` ãŒç”Ÿæˆã™ã‚‹ `RenderPositionedBox` ãªã©ã¯ `performLayout()` ã§ä»¥ä¸‹ã®ã‚ˆã†ã« __loose ãª__ `BoxConstraints` ã‚’å­ã® RenderObject ã«æ¸¡ã—ã¦ãã‚Œã¾ã™ã€‚

```dart: shifted_box.dart
class RenderPositionedBox extends RenderAligningShiftedBox {
  @override
  void performLayout() {

    // ã„ã‚ã„ã‚çœç•¥

    child!.layout(constraints.loosen(), parentUsesSize: true);
  }
```

ã“ã‚Œã‚’ä½¿ã†ã¨

```dart:main.dart
void main() => runApp(
      const MaterialApp(
        home: Scaffold(
          body: SizedBox(
            // å¹…300é«˜ã•500ã®ç®±ã®ä¸­ã«
            width: 300,
            height: 500,
            child: Align(
              child: SizedBox(
                // å¹…100é«˜ã•200ã®
                width: 100,
                height: 200,
                // é’ã„ç®±ã‚’ç½®ã
                child: ColoredBox(color: Colors.blue),
              ),
            ),
          ),
        ),
      ),
    );
```

![Align ã‚’ä½¿ã£ã¦æ”¹å–„ã—ãŸç”»åƒ](https://user-images.githubusercontent.com/20849526/210039053-f386c418-3d17-40c2-8c2e-3a79e5e14e55.png)

ã“ã‚“ãªæ„Ÿã˜ã§ `100x200` ã®ã‚µã‚¤ã‚ºã¨æ€ã‚ã‚Œã‚‹é’ã„ç®±ãŒè¡¨ç¤ºã•ã‚Œã¾ã—ãŸã€‚ãŸã ã—å ´æ‰€ã¯ `Align` ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã§ã‚ã‚‹ã€Œè¦ªã®ä¸­å¿ƒã€ã«ãªã£ã¦ã—ã¾ã†ã®ã§ã€é©å®œ `alignment` ã«å€¤ã‚’æŒ‡å®šã—ã¦ã‚ã’ã‚‹å¿…è¦ãŒã‚ã‚Šãã†ã§ã™ã­ã€‚

## å•é¡Œ2ï¼š `LayoutBuilder` ã£ã¦ Widget ã®ã‚µã‚¤ã‚ºã‚’æ•™ãˆã¦ãã‚Œã‚‹ã‚“ã˜ã‚ƒãªã„ã®ï¼Ÿ

`LayoutBuilder` ãŒæ•™ãˆã¦ãã‚Œã‚‹ã®ã¯ Widget ã®ã‚µã‚¤ã‚ºã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ã“ã“ã¾ã§è¦‹ã¦ããŸé€šã‚Šã€ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆè¨ˆç®—ã®å…ƒã«ãªã‚‹ `BoxConstraints` ã‚’æ¸¡ã—ã¦ãã‚Œã‚‹ã®ã¿ã§ã™ã€‚ãã®ãŸã‚ã€ãã® `BoxConstraints` ã‚’ä½¿ã£ã¦ `child` ãŒã©ã‚“ãªãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆè¨ˆç®—ã‚’ã—ã€ãã®çµæœã©ã‚“ãªã‚µã‚¤ã‚ºã«ãªã‚‹ã‹ã¯ `child` æ¬¡ç¬¬ã§ã™ã€‚

`LayoutBuilder` ã¯ __ã€Œç‰¹å®šã® Widget ã®ã‚µã‚¤ã‚ºã‚’ä½¿ã£ã¦ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚’çµ„ã‚€ã€ã‚’å®Ÿç¾ã™ã‚‹ãŸã‚ã® Widget ã§ã¯ãªã„__ ã“ã¨ã¯è¦šãˆã¦ãŠãã¨è‰¯ã„ã§ã—ã‚‡ã†ã€‚

## å•é¡Œ3: `OrientationBuilder` ã‚’ä½¿ãˆã°ç«¯æœ«ã®å‘ããŒæ¤œçŸ¥ã§ãã‚‹ï¼Ÿ

ã§ãã¾ã›ã‚“ã€ã¨ã„ã†ã“ã¨ã¯ [ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://api.flutter.dev/flutter/widgets/OrientationBuilder-class.html) ã«ã‚‚è¨˜è¼‰ã•ã‚Œã¦ã„ã¾ã™ãŒã€ãã®ç†ç”±ã¯ã“ã“ã¾ã§ã®è©±ã‚’å…ƒã« `OrientationBuilder` ãŒä½•ã‚’ã—ã¦ã„ã‚‹ã‹ã‚’è¦‹ã‚Œã°ä¸€ç›®ç­ç„¶ã§ã™ã€‚

```dart
class OrientationBuilder extends StatelessWidget {

  Widget _buildWithConstraints(BuildContext context, BoxConstraints constraints) {
    final Orientation orientation = constraints.maxWidth > constraints.maxHeight ? Orientation.landscape : Orientation.portrait;
    return builder(context, orientation);
  }

  @override
  Widget build(BuildContext context) {
    return LayoutBuilder(builder: _buildWithConstraints);
  }
}
```

`OrientaionBuilder` ã¯ä¸­ã§ `LayoutBuilder` ã‚’ä½¿ã£ã¦ `BoxConstraints` ã‚’å–å¾—ã—ã€ã•ã‚‰ã«ãã® `maxHeight` ã¨ `maxWidth` ã®ã©ã¡ã‚‰ãŒå¤§ãã„ã‹ã§ `Orientation.landscape` ã‹ `Orientation.portrait` ã‹ã‚’åˆ¤æ–­ã—ã¦ã„ã‚‹ã ã‘ã§ã™ã€‚

ç«¯æœ«ã®å‘ãã¯å…¨ãé–¢ä¿‚ãªã `OrientationBuilder` ã«æ¸¡ã•ã‚ŒãŸ `BoxConstraints` ã®ã¿ã§åˆ¤æ–­ã—ã¦ã„ã‚‹ä¸Šã«ã€`minWidth` ã‚„ `minHeight` ã«ã¤ã„ã¦ã¯å…¨ã¦ç„¡è¦–ã—ã¦åˆ¤å®šã—ã¦ã„ã¾ã™ã€‚ãã®ã“ã¨ã‚’ç†è§£ã—ã¦åˆ©ç”¨ã™ã‚‹ã‚ˆã†ã«ã—ã¾ã—ã‚‡ã†ã€‚

---

ä»¥ä¸Šã§ã™ã€‚

æœ€åˆã®ã†ã¡ã¯ã“ã®ã‚ãŸã‚Šã®ã“ã¨ã‚’çŸ¥ã‚‰ãªãã¦ã‚‚ã‚ã‚‹ç¨‹åº¦ UI ãŒæ§‹ç¯‰ã§ãã‚‹ã‚ˆã†ã«ã†ã¾ã API ãŒãƒ‡ã‚¶ã‚¤ãƒ³ã•ã‚Œã¦ã„ã‚‹ã®ãŒ Flutter ã®è‰¯ã„ã¨ã“ã‚ã§ã¯ã‚ã‚Šã¾ã™ãŒã€å°‘ã—è¤‡é›‘ãªãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚’å®Ÿç¾ã—ã‚ˆã†ã¨ã—ãŸã‚Šã€Widget ãŒç”»é¢ã‚’ã¯ã¿å‡ºã—ã¦ã—ã¾ã£ãŸã‚Šã€ä½¿ã„ã‚„ã™ã„å…±é€š Widget ã‚’è¨­è¨ˆã—ã‚ˆã†ã¨ã™ã‚‹ã¨ã“ã®è¾ºã‚Šã®çŸ¥è­˜ã®æœ‰ç„¡ã§ã ã„ã¶ç„¡é§„ãªè©¦è¡ŒéŒ¯èª¤ã‚„ã€ŒãŠã¾ã˜ãªã„ã€ã‚’å…¥ã‚Œã‚‹ã“ã¨ã«ãªã£ã¦ã—ã¾ã„ã¾ã™ã€‚

ã‚ã‚‹ç¨‹åº¦ Flutter ã«æ…£ã‚Œã¦ããŸã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§ã€ã“ã®ã‚ãŸã‚Šã®å†…éƒ¨çš„ãªãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆè¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯ã«ã¤ã„ã¦ã‚‚ç†è§£ã‚’æ·±ã‚ã¦ã¿ã‚‹ã¨ã‚ˆã„ã§ã—ã‚‡ã†ã€‚

[^1]: å®Ÿè£…ã‚’èª­ã‚“ã§ã„ãŸã ã‘ã‚Œã°ã‚ã‹ã‚‹é€šã‚Šã€å€¤ã‚’æŒ‡å®šã—ãªã‹ã£ãŸå ´åˆã¯æœ€å°å€¤ãŒ `0`ã€æœ€å¤§å€¤ãŒ `double.infinity` ãŒæŒ‡å®šã•ã‚Œã€å­ä¾›ã®ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆæ¬¡ç¬¬ã§ä¼¸ç¸®ã™ã‚‹è¨­å®šã«ãªã‚Šã¾ã™ã€‚